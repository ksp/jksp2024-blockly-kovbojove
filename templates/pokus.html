<!DOCTYPE html>
<html>
<head>
    <title>Blockly hra</title>
    <script type="text/javascript" src="{{ url_for('static', filename='pokus.js') }}"></script>
    <script src="https://unpkg.com/blockly/blockly.min.js"></script>
    <!--<script src="https://unpkg.com/blockly/msg/cs.js"></script>-->
</head>
<body>
    <div id="blocklyDiv" style="height: 480px; width: 100%"></div>
    <xml id="toolbox" style="display: none;"><!-- Repeat n times block -->
        <block type="controls_repeat_ext"></block>
        <block type="move_direction"></block>
        <block type="controls_if"></block>
        <block type="comparison"></block>
        <block type="arithmetic"></block>
        <block type="idx_param"></block>
        <block type="math_number"></block>
    </xml>

    <button onclick="play()">Play</button>
    <button onclick="stop()">Stop</button>

    <canvas id="gridCanvas" width="500" height="500"></canvas>

    <span id="xmlOutput"></span>

    <script>
        window.onload = function() {
            canvas = document.getElementById('gridCanvas');
            canvasContext = canvas.getContext('2d');

            drawGrid();

            workspace = Blockly.inject('blocklyDiv', {
                toolbox: {
                    "kind": "categoryToolbox",
                    "contents": [
                        {
                            "kind": "category",
                            "expanded": "true",
                            "name": "Cykly a logika",
                            "contents": [
                                {"kind": "block", "type": "controls_repeat_ext"},
                                {"kind": "block", "type": "controls_if"},
                                {"kind": "block", "type": "logic_compare"},
                                {"kind": "block", "type": "logic_operation"},
                                {"kind": "block", "type": "logic_negate"},
                            ]
                        },
                        {
                            "kind": "category",
                            "name": "Konstanty a matematika",
                            "contents": [
                                {"kind": "block", "type": "idx_param"},
                                {"kind": "block", "type": "logic_boolean"},
                                {"kind": "block", "type": "math_number"},
                                {"kind": "block", "type": "math_arithmetic"},
                                {"kind": "block", "type": "math_modulo"},
                            ]
                        },
                        {
                            "kind": "category",
                            "name": "Akce",
                            "contents": [
                                {"kind": "block", "type": "move_direction"},
                            ]
                        },
                        {
                            "kind": "category",
                            "name": "Proměnné",
                            "custom": "VARIABLE",
                        }
                    ]
                }
            });
        }

        Blockly.Blocks['move_direction'] = {
            init: function() {
                this.appendDummyInput()
                    .appendField("Move")
                    .appendField(new Blockly.FieldDropdown([
                        ["←", "LEFT"],
                        ["↑", "UP"],
                        ["→", "RIGHT"],
                        ["↓", "DOWN"]
                    ]), "DIRECTION");
                this.setPreviousStatement(true, null);
                this.setNextStatement(false, null);
                this.setColour(150);
                this.setTooltip("");
                this.setHelpUrl("");
            }
        };

        // Blockly.Blocks['comparison'] = {
        //     init: function() {
        //         this.appendValueInput("A")
        //             .setCheck("Number");
        //         this.appendDummyInput()
        //             .appendField(new Blockly.FieldDropdown([
        //                 ["≤", "LE"],
        //                 ["<", "LT"],
        //                 ["=", "EQ"]
        //             ]), "OPERATOR");
        //         this.appendValueInput("B")
        //             .setCheck("Number");
        //         this.setInputsInline(true);
        //         this.setOutput(true, "Boolean");
        //         this.setColour(10);
        //         this.setTooltip("");
        //         this.setHelpUrl("");
        //     }
        // };

        // Blockly.Blocks['arithmetic'] = {
        //     init: function() {
        //         this.appendValueInput("A")
        //             .setCheck("Number");
        //         this.appendDummyInput()
        //             .appendField(new Blockly.FieldDropdown([
        //                 ["+", "PLUS"],
        //                 ["-", "MIN"],
        //                 ["×", "MULT"],
        //                 ["÷", "DIV"],
        //                 ["%", "MOD"]
        //             ]), "OPERATOR");
        //         this.appendValueInput("B")
        //             .setCheck("Number");
        //         this.setInputsInline(true);
        //         this.setOutput(true, "Number");
        //         this.setColour(230);
        //         this.setTooltip("");
        //         this.setHelpUrl("");
        //         }
        //     };

        Blockly.Blocks['idx_param'] = {
            init: function() {
                this.appendDummyInput()
                    .appendField("index");
                this.setInputsInline(true);
                this.setOutput(true, "Number")
                this.setColour(300);
                this.setTooltip("");
                this.setHelpUrl("");
            }
        }
    </script>
</body>
